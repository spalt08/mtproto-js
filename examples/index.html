<html>
  <head>
    <script type="text/javascript" src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script> 
  </head>
  <body>
    <script type="text/javascript">
      require(['../dist/lib'], function(MTProto) {

        var tl = new MTProto.TypeLanguage(
          MTProto.Schema.MTProto, 
          MTProto.Schema.Layer105
        );

        var serverConfStr = localStorage.getItem('server_conf');
        var serverConf = {}; // serverConfStr ? JSON.parse(serverConfStr) : {};

        var server = new MTProto.Http('venus.web.telegram.org', tl, serverConf);
        
        server.onConfigurationChange(function(key, value) {
          serverConf[key] = value;
          localStorage.setItem('server_conf', JSON.stringify(serverConf));
        });

        if (!serverConf.authKeyTemp) server.authorize();

        // server.call(
        //   tl.query('help.getConfig'),
        // ).then(
        //   (res) => {
        //     console.log(res); 
        //   }
        // );

        window.m = MTProto;
        window.s = server;

        // authKey, tmpAuthKey = await server.authorize();

        // authService = new Services.Auth(transport, tl);
        // authService.getAuthKey();
        // authService.getTmpAuthKey();
        // authService.linkAuthKeys(tmp, auth);

        //MTProto.Authorize(server, tl);

        // var query = tl.query('req_pq nonce:int128 = ResPQ').randomize('nonce');

        // server.call(query, function(res) {
        //   window.res = res;
        // });

        // window.tl = tl;
        // window.m = MTProto;

        // // setTimeout(function() {
        // //   socket.send(query.compose());
        // // }, 1000);

      });
    </script>
  </body>
</html>
